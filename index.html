<!DOCTYPE html>
<html>
<head>
    <title>quake</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        font-family: "Times New Roman", Times, serif;
        font-size: 24pt;
      }

      .marquee {
        width: 100%;
        position: fixed;
        top: 0;
        height: 50px;
        background-color: black;
        color: white;
        overflow: hidden;
      }

      .marquee p {
        display: inline-block;
        margin: 0;
        animation: marquee 10s linear infinite;
      }

      @keyframes marquee {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.2/web3.min.js" integrity="sha512-qfNEgqdLEd+OkOZSZxb9kPOvOz62NNoPd0A5W5G8LMwfdtKn3+5D/tx5zvgu+7IaPqkFq60VfJ+Mn1bVJjMx/w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      let web3;
      let contractABI;

      function isMetaMaskInstalled() {
        return typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask;
      }

      function getNetworkId() {
        return new Promise((resolve, reject) => {
          ethereum.request({ method: 'net_version' }, (error, networkId) => {
            if (error) {
              reject(error);
            } else {
              resolve(networkId);
            }
          });
        });
      }

      async function checkMetaMask() {
        try {
          const isInstalled = isMetaMaskInstalled();
          if (isInstalled) {
            const networkId = await getNetworkId();
            if (networkId === '137') {
              document.getElementById('network-status').textContent = 'Connected to Polygon';
            } else {
              document.getElementById('network-status').textContent = 'WRONG NETWORK';
            }
          } else {
            document.getElementById('network-status').textContent = 'MetaMask not found';
          }
        } catch (error) {
          console.error(error);
          document.getElementById('network-status').textContent = 'Error checking MetaMask';
        }
      }

      function initWeb3() {
        return new Promise((resolve, reject) => {
          if (isMetaMaskInstalled()) {
            web3 = new Web3(window.ethereum);
            window.ethereum.enable()
              .then(() => {
                console.log('Web3 initialized');
                resolve();
              })
              .catch(error => {
                console.error('Error while initializing Web3:', error);
                reject();
              });
          } else {
            console.error('Web3 not available');
            reject();
          }
        });
      }

      async function initContract() {
        // The address of your deployed contract
        // Note: You should replace this with the address of your deployed contract
        const contractAddress = '0x4772f95fc2dca4564c6ec0659cadaa068cc4578f';

        try {
          const accounts = await web3.eth.getAccounts();
          const account = accounts[0];
          console.log('Minting NFT for account:', account);

          if (contractABI) {
            const contract = new web3.eth.Contract(contractABI, contractAddress);
            console.log('Contract initialized:', contract);

            document.getElementById('mint-button').addEventListener('click', mintNFT);
          } else {
            console.error('Contract ABI not available');
          }
        } catch (error) {
          console.error('Error while initializing contract:', error);
        }
      }

      async function mintNFT() {
        try {
          const accounts = await web3.eth.getAccounts();
          const account = accounts[0];
          console.log('Minting NFT for account:', account);

          if (contractABI) {
            const contract = new web3.eth.Contract(contractABI, contractAddress);
            contract.methods.mintNFT(account).send({ from: account })
              .on('transactionHash', function(hash) {
                console.log("Transaction Hash:", hash);
              })
              .on('confirmation', function(confirmationNumber, receipt) {
                console.log("Confirmation Number:", confirmationNumber);
                console.log("Receipt:", receipt);
              })
              .on('error', function(error) {
                console.error('Error while minting NFT:', error);
              });
          } else {
            console.error('Contract ABI not available');
          }
        } catch (error) {
          console.error('Error while minting NFT:', error);
        }
      }

      async function initialize() {
        await initWeb3();
        await initContract();
      }

      document.addEventListener('DOMContentLoaded', () => {
        checkMetaMask();
        initialize();
      });
    </script>
</head>
<body>
  <div class="marquee">
    <p>Mint your QUAKE PASS now</p>
  </div>

  <button id="mint-button">Mint QUAKE PASS</button>
  <p id="network-status"></p>
</body>
</html>
