<!DOCTYPE html>
<html>
<head>
    <title>quake</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        font-family: "Times New Roman", Times, serif;
        font-size: 24pt;
      }

      .marquee {
        width: 100%;
        position: fixed;
        top: 0;
        height: 50px;
        background-color: black;
        color: white;
        overflow: hidden;
      }

      .marquee p {
        display: inline-block;
        margin: 0;
        animation: marquee 10s linear infinite;
      }

      @keyframes marquee {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.2/web3.min.js" integrity="sha512-qfNEgqdLEd+OkOZSZxb9kPOvOz62NNoPd0A5W5G8LMwfdtKn3+5D/tx5zvgu+7IaPqkFq60VfJ+Mn1bVJjMx/w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      // Check if MetaMask is installed and is connected
      if (typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask) {
        // Check if the current network is Polygon
        ethereum.request({ method: 'net_version' }, (error, networkId) => {
          if (error) {
            console.error(error);
          } else if (networkId === '137') {
            // The current network is Polygon
            document.getElementById('network-status').textContent = 'Connected to Polygon';
          } else {
            // The current network is not Polygon
            document.getElementById('network-status').textContent = 'WRONG NETWORK';
          }
        });
      } else {
        // MetaMask is not installed or is not connected
        document.getElementById('network-status').textContent = 'MetaMask not found';
      }
    </script>
    <script type="module">
      // Declare contractABI as a global variable
      let contractABI;

      // Load contractABI from external file
      fetch('https://raw.githubusercontent.com/wrekafekt/QUAKEPASS/main/contractABI.js')
        .then(response => response.text())
        .then(data => {
          // Parse the fetched data as JavaScript code
          const script = document.createElement('script');
          script.innerHTML = data;
          document.head.appendChild(script);
          contractABI = window.contractABI; // Assign the loaded contractABI to the global variable
          initialize(); // Call the initialize function after loading the contractABI
        })
        .catch(error => {
          console.error('Error loading contractABI:', error);
        });

      function initWeb3() {
        return new Promise((resolve, reject) => {
          if (typeof window.ethereum !== 'undefined') {
            web3 = new Web3(window.ethereum);
            window.ethereum.enable()
              .then(() => {
                console.log('Web3 initialized');
                resolve();
              })
              .catch(error => {
                console.error('Error while initializing Web3:', error);
                reject();
              });
          } else {
            console.error('Web3 not available');
            reject();
          }
        });
      }

      async function initContract() {
        // The address of your deployed contract
        // Note: You should replace this with the address of your deployed contract
        const contractAddress = '0x4772f95fc2dca4564c6ec0659cadaa068cc4578f';

        try {
          const accounts = await web3.eth.getAccounts();
          const account = accounts[0];
          console.log('Minting NFT for account:', account);

          if (contractABI) {
            contract = new web3.eth.Contract(contractABI, contractAddress);
            console.log('Contract initialized:', contract);

            document.getElementById('mint-button').addEventListener('click', mintNFT);
          } else {
            console.error('Contract ABI not available');
          }
        } catch (error) {
          console.error('Error while initializing contract:', error);
        }
      }

      async function mintNFT() {
        try {
          const accounts = await web3.eth.getAccounts();
          const account = accounts[0];
          console.log('Minting NFT for account:', account);

          if (contract) {
            contract.methods.mintNFT(account).send({ from: account })
              .on('transactionHash', function(hash) {
                console.log("Transaction Hash:", hash);
              })
              .on('confirmation', function(confirmationNumber, receipt) {
                console.log("Confirmation Number:", confirmationNumber);
                console.log("Receipt:", receipt);
              })
              .on('error', function(error) {
                console.error('Error while minting NFT:', error);
              });
          } else {
            console.error('Contract not available');
          }
        } catch (error) {
          console.error('Error while minting NFT:', error);
        }
      }

      async function initialize() {
        await initWeb3();
        await initContract();
      }
    </script>
</head>
<body>
  <div class="marquee">
    <p>Mint your QUAKE PASS now</p>
  </div>

  <button id="mint-button">Mint QUAKE PASS</button>

</body>
</html>
